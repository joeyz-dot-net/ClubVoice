{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "Build Only",
            "type": "shell",
            "command": "pyinstaller ClubVoice.spec -y; if ($?) { Copy-Item config.ini dist\\ -Force; Write-Host ''; Write-Host '✓ 已复制 config.ini' -ForegroundColor Green; Write-Host ''; Write-Host '本地构建完成！' -ForegroundColor Green; Write-Host '输出目录: .\\dist\\' -ForegroundColor Cyan } else { Write-Host '构建失败!' -ForegroundColor Red }",
            "group": "build",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "shared",
                "showReuseMessage": false,
                "clear": true
            },
            "problemMatcher": [],
            "detail": "仅构建 EXE（不部署）"
        },
        {
            "label": "Deploy to B560",
            "type": "shell",
            "command": "$dest='\\\\b560\\code\\ClubVoice'; $source='.\\dist'; $timestamp=Get-Date -Format 'yyyyMMdd_HHmmss'; if (!(Test-Path $source)) { Write-Host '错误: dist 目录不存在，请先构建！' -ForegroundColor Red; Read-Host '按 Enter 键关闭窗口'; exit 1 }; if (!(Test-Path $dest)) { Write-Host '目标目录不存在，正在创建...' -ForegroundColor Yellow; New-Item -ItemType Directory -Path $dest -Force | Out-Null }; Write-Host ''; Write-Host '正在部署到 \\\\b560\\code\\ClubVoice...' -ForegroundColor Cyan; $renamedCount=0; Get-ChildItem -Path $source\\* -Recurse -File | ForEach-Object { $relativePath = $_.FullName.Replace((Get-Location).Path + '\\dist\\', ''); $destPath = Join-Path $dest $relativePath; $destDir = Split-Path $destPath -Parent; if (!(Test-Path $destDir)) { New-Item -ItemType Directory -Path $destDir -Force | Out-Null }; if (Test-Path $destPath) { $ext = $_.Extension; $nameWithoutExt = [System.IO.Path]::GetFileNameWithoutExtension($destPath); $oldName = $nameWithoutExt + '_old_' + $timestamp + $ext; $oldPath = Join-Path (Split-Path $destPath -Parent) $oldName; Rename-Item -Path $destPath -NewName $oldName -Force; $renamedCount++; Write-Host ('  重命名旧文件: ' + $oldPath) -ForegroundColor Yellow }; Copy-Item -Path $_.FullName -Destination $destPath -Force; Write-Host ('  复制: ' + $destPath) -ForegroundColor Gray }; Write-Host ''; if ($renamedCount -gt 0) { Write-Host ('已重命名 ' + $renamedCount + ' 个旧文件') -ForegroundColor Yellow }; Write-Host '部署完成！' -ForegroundColor Green; Write-Host ('目标目录: ' + $dest) -ForegroundColor Cyan; Read-Host '按 Enter 键关闭窗口'",
            "group": "none",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "shared",
                "showReuseMessage": false,
                "clear": true
            },
            "problemMatcher": [],
            "detail": "将 dist 目录部署到 \\\\b560\\code\\ClubVoice"
        },
        {
            "label": "Deploy to Local",
            "type": "shell",
            "command": "$dest='D:\\Code\\ClubVoice-Deploy'; $source='.\\dist'; if (!(Test-Path $source)) { Write-Host '错误: dist 目录不存在，请先构建！' -ForegroundColor Red; Read-Host '按 Enter 键关闭窗口'; exit 1 }; if (Test-Path $dest) { Write-Host '清理旧部署目录...' -ForegroundColor Yellow; Remove-Item -Path $dest -Recurse -Force }; Write-Host '创建部署目录...' -ForegroundColor Yellow; New-Item -ItemType Directory -Path $dest -Force | Out-Null; Write-Host ''; Write-Host '正在部署到 D:\\Code\\ClubVoice-Deploy...' -ForegroundColor Cyan; Copy-Item -Path $source\\* -Destination $dest -Recurse -Force; Get-ChildItem -Path $dest\\* -Recurse -File | ForEach-Object { $relativePath = $_.FullName.Replace($dest + '\\', ''); Write-Host \"  复制: $relativePath\" -ForegroundColor Gray }; Write-Host ''; Write-Host '部署完成！' -ForegroundColor Green; Write-Host \"目标目录: $dest\" -ForegroundColor Cyan; Read-Host '按 Enter 键关闭窗口'",
            "group": "none",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "shared",
                "showReuseMessage": false,
                "clear": true
            },
            "problemMatcher": [],
            "detail": "将 dist 目录部署到 D:\\Code\\ClubVoice-Deploy"
        },
        {
            "label": "Run App",
            "type": "shell",
            "command": "python",
            "args": [
                "run.py"
            ],
            "group": "test",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": true,
                "panel": "dedicated",
                "showReuseMessage": false
            },
            "problemMatcher": [],
            "detail": "直接运行 Python 程序"
        },
        {
            "label": "Run EXE",
            "type": "shell",
            "command": ".\\dist\\ClubVoice.exe",
            "group": "test",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": true,
                "panel": "dedicated",
                "showReuseMessage": false
            },
            "problemMatcher": [],
            "detail": "运行打包后的 EXE"
        },
        {
            "label": "Clean Build",
            "type": "shell",
            "command": "Remove-Item -Recurse -Force build, dist -ErrorAction SilentlyContinue",
            "group": "none",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "shared",
                "showReuseMessage": false
            },
            "problemMatcher": [],
            "detail": "清理构建目录"
        },
        {
            "label": "Full Build",
            "dependsOn": [
                "Clean Build",
                "Build Only",
                "Deploy to B560"
            ],
            "dependsOrder": "sequence",
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "problemMatcher": [],
            "detail": "清理 + 构建 + 部署到 B560（默认）"
        },
        {
            "label": "Build and Deploy Local",
            "dependsOn": [
                "Build Only",
                "Deploy to Local"
            ],
            "dependsOrder": "sequence",
            "group": "build",
            "problemMatcher": [],
            "detail": "构建 + 部署到本地 D:\\Code"
        }
    ]
}
