<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>HLS Player</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body{display:flex;align-items:center;justify-content:center;height:100vh;margin:0;background:#0f1724;color:#e6eef8;font-family:system-ui,Segoe UI,Roboto,Arial}
    .card{display:flex;flex-direction:column;align-items:center;gap:18px;padding:24px;border-radius:12px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    #playbtn{appearance:none;border:0;padding:18px 28px;border-radius:12px;background:#2563eb;color:#fff;font-size:18px;cursor:pointer;box-shadow:0 6px 14px rgba(37,99,235,0.32)}
    #playbtn.paused{background:#10b981}
    #status{font-size:13px;opacity:0.85}
    video{display:none}
  </style>
</head>
<body>
  <div class="card">
    <div style="font-weight:600;font-size:18px">点击收听</div>
    <button id="playbtn">Play</button>
    <div id="status">Idle</div>
    <video id="video" playsinline></video>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@1"></script>
  <script>
    const url = '/stream.m3u8';
    const video = document.getElementById('video');
    const btn = document.getElementById('playbtn');
    const status = document.getElementById('status');
    let hls = null;
    function attach() {
      if (window.Hls && Hls.isSupported()) {
        hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, ()=>{ status.textContent = 'Ready' });
        hls.on(Hls.Events.ERROR, (e,d)=>{ console.warn('hls error', e, d); status.textContent = 'Player error'; });
      } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = url;
        status.textContent = 'Ready';
      } else {
        status.textContent = 'No HLS support';
      }
    }
    attach();

    btn.addEventListener('click', async ()=>{
      if (video.paused) {
        try {
          await video.play();
          btn.textContent = 'Pause';
          btn.classList.add('paused');
          status.textContent = 'Playing';
        } catch(err) {
          console.warn('play failed', err);
          status.textContent = 'Play error';
        }
      } else {
        video.pause();
        btn.textContent = 'Play';
        btn.classList.remove('paused');
        status.textContent = 'Paused';
      }
    });
    // update status on stall/buffering
    video.addEventListener('waiting', ()=>status.textContent='Buffering');
    video.addEventListener('playing', ()=>status.textContent='Playing');
    video.addEventListener('stalled', ()=>status.textContent='Stalled');
  </script>
</body>
</html>